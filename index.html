<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<title>四人将棋 UI完全再現</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<style>
body{
  background:#d89a2c;
  font-family:"Hiragino Kaku Gothic ProN","Yu Gothic",sans-serif;
  margin:0;padding:10px;
}

h1{margin:6px 0;font-size:18px}

:root{
  --cell:42px;
  --line:#000;
  --cellbg:#f4d9a6;
}

#container{
  display:grid;
  grid-template-columns: auto 1fr auto;
  grid-template-rows: auto 1fr auto;
  gap:10px;
  justify-items:center;
  align-items:center;
}

/* ================= 盤 ================= */
#board{
  grid-column:2;
  grid-row:2;
  display:grid;
  grid-template-columns:repeat(13,var(--cell));
  grid-template-rows:repeat(13,var(--cell));
  border:3px solid var(--line);
  background:#c6862c;
}

.cell{
  width:var(--cell);
  height:var(--cell);
  background:var(--cellbg);
  border:1px solid var(--line);
  display:flex;
  justify-content:center;
  align-items:center;
  cursor:pointer;
  user-select:none;
}

.cell.empty{background:#d89a2c;border:none}

/* ================= 駒 ================= */
.piece{
  font-size:20px;
  font-weight:bold;
}

.o0{transform:rotate(180deg)}
.o1{transform:rotate(270deg)}
.o2{transform:rotate(0deg)}
.o3{transform:rotate(90deg)}

.dead{opacity:.3}

/* ================= 持ち駒 ================= */
.hand{
  background:#fff1c1;
  border:2px solid #000;
  padding:4px;
  min-width:120px;
  display:flex;
  flex-wrap:wrap;
  gap:4px;
  justify-content:center;
}

.hand span{
  background:#fff;
  border:1px solid #000;
  padding:2px 4px;
  cursor:pointer;
}

/* ================= 配置 ================= */
#hand0{grid-column:2;grid-row:1}
#hand1{grid-column:3;grid-row:2}
#hand2{grid-column:2;grid-row:3}
#hand3{grid-column:1;grid-row:2}

#controls{
  grid-column:1/4;
  grid-row:4;
  text-align:center;
}
</style>
</head>

<body>
<h1>四人将棋（UI完全再現）</h1>

<div id="container">
  <div class="hand" id="hand0"></div>
  <div class="hand" id="hand1"></div>

  <div id="board"></div>

  <div class="hand" id="hand3"></div>
  <div class="hand" id="hand2"></div>

  <div id="controls">
    <button onclick="undo()">待った</button>
    <button onclick="init()">初期化</button>
    <span id="turn"></span>
  </div>
</div>

<script>
/* ======= ロジック部分（前回と同一）======= */
const N=13;
let board,turn=0,sel=null,history=[];
let alive=[true,true,true,true];
let hands=[[],[],[],[]];

const back=['香','桂','銀','金','王','金','銀','桂','香'];
const promote={歩:'と',香:'杏',桂:'圭',銀:'全',角:'馬',飛:'龍'};
const unp={と:'歩',杏:'香',圭:'桂',全:'銀',馬:'角',龍:'飛'};

function empty(){board=[...Array(N)].map(()=>Array(N).fill(null));}

function init(){
  empty();
  hands=[[],[],[],[]];
  alive=[true,true,true,true];
  history=[];
  turn=0; sel=null;
  place(); draw();
}

function place(){
  let c=[2,3,4,5,6,7,8,9,10];
  for(let i=0;i<9;i++) board[0][c[i]]={t:back[i],o:0};
  board[1][3]={t:'飛',o:0}; board[1][9]={t:'角',o:0};
  for(let i=0;i<9;i++) board[2][c[i]]={t:'歩',o:0};

  let r=[2,3,4,5,6,7,8,9,10];
  for(let i=0;i<9;i++) board[r[i]][12]={t:back[i],o:1};
  board[3][11]={t:'飛',o:1}; board[9][11]={t:'角',o:1};
  for(let i=0;i<9;i++) board[r[i]][10]={t:'歩',o:1};

  for(let i=0;i<9;i++) board[12][c[8-i]]={t:back[i],o:2};
  board[11][9]={t:'飛',o:2}; board[11][3]={t:'角',o:2};
  for(let i=0;i<9;i++) board[10][c[8-i]]={t:'歩',o:2};

  for(let i=0;i<9;i++) board[r[8-i]][0]={t:back[i],o:3};
  board[9][1]={t:'飛',o:3}; board[3][1]={t:'角',o:3};
  for(let i=0;i<9;i++) board[r[8-i]][2]={t:'歩',o:3};
}

/* ==== 描画 ==== */
function draw(){
  const b=document.getElementById("board");
  b.innerHTML="";
  for(let r=0;r<N;r++)for(let c=0;c<N;c++){
    let d=document.createElement("div");
    let valid=(r>=2&&r<=10)||(c>=2&&c<=10);
    d.className="cell"+(valid?"":" empty");
    if(valid)d.onclick=()=>click(r,c);
    let p=board[r][c];
    if(p){
      let s=document.createElement("span");
      s.textContent=p.t;
      s.className="piece o"+p.o+(alive[p.o]?"":" dead");
      d.appendChild(s);
    }
    b.appendChild(d);
  }
  for(let i=0;i<4;i++){
    let h=document.getElementById("hand"+i);
    h.innerHTML="";
    hands[i].forEach(x=>{
      let s=document.createElement("span");
      s.textContent=x; h.appendChild(s);
    });
  }
  document.getElementById("turn").textContent="手番：プレイヤー"+(turn+1);
}

function click(r,c){
  let p=board[r][c];
  if(sel){
    let s=sel;
    history.push(JSON.stringify({board,hands,alive,turn}));
    board[r][c]=board[s.r][s.c];
    board[s.r][s.c]=null;
    sel=null;
    turn=(turn+1)%4;
    draw(); return;
  }
  if(p&&p.o==turn){sel={r,c};}
}

function undo(){
  if(!history.length)return;
  let h=JSON.parse(history.pop());
  board=h.board;hands=h.hands;alive=h.alive;turn=h.turn;
  draw();
}

init();
</script>
</body>
</html>
